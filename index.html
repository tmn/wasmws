<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">

  <title>Web Assembly</title>

  <link rel="stylesheet" href="./css/reveal.min.css">
  <link rel="stylesheet" href="./css/bekk.css">
  <link rel="stylesheet" href="./css/style.css">

</head>

<body>

  <div class="reveal">

    <div class="slides">

      <section>
        <h2>WebAssembly</h2>
        <br />
        <br />
        <br />

        <p>Tri Nguyen | <a href="http://twitter.com/itmn">@itmn</a></p>
        <p>Trond Klakken | <a href="http://twitter.com/trondkla">@trondkla</a></p>
        <p><a href="http://open.bekk.no">open.bekk.no</a></p>
      </section>

      <section id="intro">
        <section>
          <h2>What is it?</h2>


          <aside class="notes">
            <ul>
              <li>Notat</li>
            </ul>
          </aside>
        </section>

        <section>
          <p>... a portable, size- and load-time-efficient binary format for executing code on the web</p>
        </section>
      </section>

      <section>
        <section>
          <h2>What is it good for?</h2>

        </section>
      </section>

      <section>
        <section>
          <h2>How does it work?</h2>
        </section>


        <section>
          <h2>Emscripten</h2>

          <p>LLVM-to-JavaScript compiler</p>
          <p>It works as a back-end to the LLVM compiler</p>
        </section>
      </section>

      <section id="ast">
          <section>
              <h2>AST</h2>
              <h3>Abstract syntax tree</h3>
          </section>
          <section>
              <div class="two-items">

                  <div class="item">
                      <img style="background: white;" src="images/Abstract_syntax_tree_for_Euclidean_algorithm.svg" />
                  </div>

                  <div class="item">
                      <p>Euclidean algorithm to find the greatest common divisor of a and b:</p>
<pre style="font-size: 1em">
  <b>while</b> b ≠ 0
      <b>if</b> a &gt; b
         a := a − b
      <b>else</b>
         b := b − a
  <b>return</b> a
</pre>
                      <a href="https://en.wikipedia.org/wiki/Abstract_syntax_tree#/media/File:Abstract_syntax_tree_for_Euclidean_algorithm.svg">Wikipedia</a>

                  </div>
              </div>
          </section>

          <section>
              <h3>TypeScript:</h3>
<pre style="font-size: 1em;">
function addTwo(a: number, b: number): number {
    return a + b;
}
</pre>
                <h3>.wast</h3>
<pre style="font-size: 1em;">
    (module
      (func $addTwo (param i32 i32) (result i32)
        (i32.add
          (get_local 0)
          (get_local 1)))
      (export "addTwo" (func $addTwo)))
</pre>
          </section>

          <section>
              <h3>.wasm, assembly file</h3>
              <pre id="output">
0000000: 0061 736d                                 ; WASM_BINARY_MAGIC
0000004: 0d00 0000                                 ; WASM_BINARY_VERSION
; section "TYPE" (1)
0000008: 01                                        ; section code
0000009: 00                                        ; section size (guess)
000000a: 01                                        ; num types
; type 0
000000b: 60                                        ; func
000000c: 02                                        ; num params
000000d: 7f                                        ; i32
000000e: 7f                                        ; i32
000000f: 01                                        ; num results
0000010: 7f                                        ; i32
0000009: 07                                        ; FIXUP section size
; section "FUNCTION" (3)
0000011: 03                                        ; section code
0000012: 00                                        ; section size (guess)
0000013: 01                                        ; num functions
0000014: 00                                        ; function 0 signature index
0000012: 02                                        ; FIXUP section size
...                                                 ...
</pre>
          </section>

          <section>
<pre>
...                                                 ...
; section "EXPORT" (7)
0000015: 07                                        ; section code
0000016: 00                                        ; section size (guess)
0000017: 01                                        ; num exports
0000018: 06                                        ; string length
0000019: 6164 6454 776f                           addTwo  ; export name
000001f: 00                                        ; export kind
0000020: 00                                        ; export func index
0000016: 0a                                        ; FIXUP section size
; section "CODE" (10)
0000021: 0a                                        ; section code
0000022: 00                                        ; section size (guess)
0000023: 01                                        ; num functions
; function body 0
0000024: 00                                        ; func body size (guess)
0000025: 00                                        ; local decl count
0000026: 20                                        ; get_local
0000027: 00                                        ; local index
0000028: 20                                        ; get_local
0000029: 01                                        ; local index
000002a: 6a                                        ; i32.add
000002b: 0b                                        ; end
0000024: 07                                        ; FIXUP func body size
0000022: 09                                        ; FIXUP section size
        </pre>

        </section>

    </section>

    <section>
         <section>
            <h3>Single Instruction Single Data</h3>

            <img src="images/sisd.png" style="height: 16em;">

            <p>*<a href="http://archive.arstechnica.com/cpu/1q00/simd/m-simd-1.html">arstechnica</a></p>

            <aside class="notes">
                <ul>
                    <li>ADD</li>
                    <li>SUB</li>
                    <li>DIV</li>
                    <li>LOAD</li>
                    <li>STORE</li>
                </ul>
            </aside>
        </section>

        <section id="instruction-set">
            <h4>SISD</h4>
            <p>A + B = C</p>
            <div class="two-items">

                <p class="item">Minne:</p>
                <table class="border item">
                    <tr>
                        <th>M0</th>
                        <th>M1</th>
                        <th>M2</th>
                        <th>M3</th>
                        <th>..</th>
                    </tr>
                    <tr>
                        <td>A</td>
                        <td>B</td>
                        <td class="fragment" data-fragment-index="4">C</td>
                        <td>..</td>
                        <td>..</td>
                    </tr>
                </table>
            </div>

            <div class="two-items">
                <p class="item">CPU registre:</p>
                <table class="border item">
                    <tr>
                        <th>R0</th>
                        <th>R1</th>
                        <th>R2</th>
                        <th>R3</th>
                        <th>..</th>
                        <th>R16</th>
                    </tr>
                    <tr>
                        <td class="fragment" data-fragment-index="1">A</td>
                        <td class="fragment" data-fragment-index="2">B</td>
                        <td class="fragment" data-fragment-index="3">C</td>
                        <td>..</td>
                        <td>..</td>
                        <td>..</td>
                    </tr>
                </table>
            </div>
            <p>Oppgave: Legg sammen 16 tall med 16 andre</p>
            <ol>
                <li class="fragment" data-fragment-index="1">LOAD M0, R0 - Last A inn i R0 fra minne</li>
                <li class="fragment" data-fragment-index="2">LOAD M1, R1 - Last B inn i R1 fra minne</li>
                <li class="fragment" data-fragment-index="3">ADD R0, R1 into R2 - Legg sammen R0 + R1 og lagre i R2</li>
                <li class="fragment" data-fragment-index="4">STORE R2, M2 - Skriv R2 til minne</li>
            </ol>

            <aside class="notes">
                <ul>
                    <li>Blokker i byte</li>
                    <li>Ingen garanti at de er etter hverandre</li>
                    <li>4 klokkesykler per tall</li>
                </ul>
            </aside>
        </section>
    </section>

    <section id="simd">
        <section>
            <h2>SIMD<h2>
            <h3>Single Instruction Multiple Data</h3>
            <div class="two-images">
                <img src="images/nosimd2.gif" />
                <img src="images/simd2.gif" />
            </div>
            <a href="https://blogs.windows.com/msedgedev/2015/05/21/intel-and-microsoft-partnering-for-an-improved-web-experience/#OoHAi6lQxWyvSMmQ.97">By Microsoft Edge Team</a>
        </section>

        <section>
            <img src="images/simd.png" style="height: 16em;">

            <p>*<a href="http://archive.arstechnica.com/cpu/1q00/simd/m-simd-1.html">arstechnica</a></p>
        </section>

        <section id="simd-vector-problem">
            <h4>SIMD - Vector</h4>

            <p>Oppgave: Legg sammen 16 tall med 16 andre</p>

            <p>A<sub>1</sub> + B<sub>1</sub> = C<sub>1</sub>, </p>
            <p>A<sub>2</sub> + B<sub>2</sub> = C<sub>2</sub>, </p>
            <p> ... ,</p>
            <p>A<sub>16</sub> + B<sub>16</sub> = C<sub>16</sub></p>
        </section>

        <section id="simd-vector">
            <h4>SIMD - Vector</h4>

            <div class="two-items">

                <p class="item">Minne:</p>
                <table class="border item">
                    <tr>
                        <th>M0</th>
                        <th>M1</th>
                        <th>..</th>
                        <th>M8</th>
                        <th>M9</th>
                        <th>..</th>
                        <th>M16</th>
                        <th>M17</th>
                        <th>..</th>
                    </tr>
                    <tr>
                        <td>A<sub>1</sub> </td>
                        <td>A<sub>2</sub> </td>
                        <td>..</td>
                        <td>B<sub>1</sub> </td>
                        <td>B<sub>2</sub> </td>
                        <td>..</td>
                        <td class="fragment" data-fragment-index="4">C<sub>1</sub> </td>
                        <td class="fragment" data-fragment-index="4">C<sub>2</sub> </td>
                        <td>..</td>
                    </tr>
                </table>
            </div>

            <div class="two-items">
                <span class="item">
                    <p>CPU vector register</p>
                    <p>(512kb, 16 int, 8 long):</p>
                </span>
                <table class="border item">
                    <tr>
                        <th>R0</th>
                        <th>R1</th>
                        <th>R2</th>
                        <th>..</th>
                    </tr>
                    <tr>
                        <td class="fragment" data-fragment-index="1">
                            A<sub>1</sub> ,
                            A<sub>2</sub> ,
                            ... ,
                            A<sub>8</sub> ,
                        </td>
                        <td class="fragment" data-fragment-index="2">
                            B<sub>1</sub> ,
                            B<sub>2</sub> ,
                            ... ,
                            B<sub>8</sub> ,
                        </td>
                        <td class="fragment" data-fragment-index="3">
                            C<sub>1</sub> ,
                            C<sub>2</sub> ,
                            ... ,
                            C<sub>8</sub> ,
                        </td>
                        <td>..</td>
                    </tr>
                </table>
            </div>
            <ol>
                <li class="fragment" data-fragment-index="1">LOAD_VECTOR M0, R0 - Laster inn 512kb som starter fra minnelokasjon M0</li>
                <li class="fragment" data-fragment-index="2">LOAD_VECTOR M8, R1 - Laster inn 512kb som starter fra minnelokasjon M1</li>
                <li class="fragment" data-fragment-index="3">ADD_VECTOR_INT64 R0, R1 into R2 - Legg sammen 8 longs fra R0 + R1 og lagre i R2</li>
                <li class="fragment" data-fragment-index="4">STORE R2, M2 - Skriv R2 til minnelokasjonen som starter ved M2</li>
            </ol>

            <aside class="notes">
                <ul>
                    <li>Vector: 512 bit</li>
                    <li>Laster inn [1, 2, 1, 4, 6] = 16 float, int, eller 8 double long samtidig</li>
                    <li>Ligger lagret etter hverandre i minne</li>
                    <li>Spesialregister</li>
                    <li>To klokke sykler</li>
                </ul>
            </aside>
        </section>
    </section>

      <section id="outro">
        <h2>Takk for oss!</h2>
      </section>
    </div>

  </div>

  <script src="./lib/js/head.min.js"></script>
  <script src="./js/reveal.min.js"></script>
  <script type="text/javascript" src="./vendor/prefixfree.min.js"></script>

  <script>

  Reveal.initialize({
    controls: true,
    progress: true,
    history: true,
    center: true,
    transition: 'fade', //Default - None - Fade - Slide - Concave - Zoom
    dependencies: [
      { src: 'lib/js/classList.js', condition: function() { return !document.body.classList; }},
      { src: 'plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
    ]
  });

  </script>
</body>
</html>
